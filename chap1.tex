%% This is an example first chapter.  You should put chapter/appendix that you
%% write into a separate file, and add a line \include{yourfilename} to
%% main.tex, where `yourfilename.tex' is the name of the chapter/appendix file.
%% You can process specific files by typing their names in at the 
%% \files=
%% prompt when you run the file main.tex through LaTeX.
\chapter{Motivación del diseño y desarrollo de XRemoteBot}\label{ch1}
% FIXME \section{Motivación del diseño y desarrollo de XRemoteBot}\label{ch1:motivacion}

\section{Motivación}\label{sec:motivacion}
Desde el año 2009, en el marco del proyecto ``Programando con robots y
software libre'' de la Facultad de Informática,
se brindan cursos de programación en Python para alumnos de escuelas
secundarias utilizando robots didácticos.

En un comienzo se utilizaron los robots Scribbler de Parallax
(figura~\ref{fig:robots_usados_scribbler}), los mismos se
pueden programar directamente a través de un cable en el lenguaje
PBASIC y funcionar de forma autónoma o pueden ser controlados de forma
inalámbrica con Bluetooth, durante las actividades se utilizó de la última
forma que permite controlarlo usando el lenguaje Python cuyo intérprete no
es posible ejecutar directamente sobre el microcontrolador del robot.

Estos robots se importaban desde Estados Unidos en volúmenes bajos lo que
dificultaba su adquisición y dejaba al equipo sin ninguna garantía ante
averías, por estos motivos se buscaron alternativas de fabricación nacional,
que pudieran utilizarse desde Python y tuvieran especificaciones abiertas.
De esta manera en el año 2011 se adquirieron para pruebas robots Multiplo N6
de la empresa RobotGroup (figura~\ref{fig:robots_usados_n6})
cuyas especificaciones se distribuyen bajo una licencia libre y
la empresa se comprometió a la creación de una biblioteca Python que permitiera
su programación en ese lenguaje, esa biblioteca se desarrolló en conjunto
con miembros del laboratorio LINTI y miembros de la empresa RobotGroup siendo
mantenida en la actualidad por los primeros. Los robots Multiplo N6 son
controlados por una placa basada en Arduino, la misma se puede programar
a través de un cable en el lenguaje C++ de manera que el robot luego funcione
de manera autónoma y también pueden ser controlados de forma inalámbrica
a través del protocolo ZigBee~\citep{diaz_aprendiendo_2012}. La placa
controladora del N6 se denomina DuinoBot y no debe confundirse con la biblioteca
Python del mismo nombre que se desarrolló en conjunto con la empresa RobotGroup
para controlar estos robots. De aquí en adelante se denominará DuinoBot a la
biblioteca y placa controladora al componente de hardware que contiene el
microcontrolador a menos que se especifique lo contrario.



En el año 2012, a través de una cooperación con la Fundación YPF que brindó
un subsidio y bajo el auspicio de la Dirección de Escuelas Técnicas de la
Provincia de Buenos Aires se dictaron cursos en 10 escuelas técnicas de la
provincia. La fundación YPF brindó a cada una de estas escuelas, entre otras
cosas, 20 robots Multiplo N6 que quedarían en cada escuela, en estos cursos
se capacitó a 140 docentes y 40 alumnos avanzados en programación en Python
a través del uso de estos dispositivos~\citep{diaz_aprendiendo_2012}.
Esta experiencia consolidó el uso de
los robots N6 para los cursos dictados en el marco del proyecto
``Programando con robots y software libre'' donde estos robots desplazaron
a los Scribblers por su confiabilidad y stock, dadas las dificultades de
reponer los Scribblers a medida que se averiaban por los motivos
ya mencionados.

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.49\textwidth}
        \includegraphics[width=\textwidth]{figures/scribbler}
        \subcaption{Robot Scribbler de Parallax}\label{fig:robots_usados_scribbler}
    \end{subfigure}
    \begin{subfigure}[b]{0.49\textwidth}
        \includegraphics[width=\textwidth]{figures/n6}
        \subcaption{Robot Multiplo N6 de RobotGroup}\label{fig:robots_usados_n6}
    \end{subfigure}
    \caption{Robots usados en el proyecto}\label{fig:robots_usados}
\end{figure}

\section{Los robots}
Como se mencionó anteriormente se utilizaron a lo largo del proyecto dos
modelos de robots distintos, los Scribbler y los N6. Esta sección tiene una
breve reseña de sus características técnicas.

\subsection{Scribbler de Parallax}
Los robots Scribbler (versión 1) cuentan con un microcontrolador
\textit{PIC16F57} que viene programado con un intérprete de Basic, el producto
completo es denominado por Parallax ``Basic Stamp 2''.
Para su locomoción este robot cuenta con dos ruedas conectadas a través de
cajas
reductoras~\footnote{\url{http://es.wikipedia.org/wiki/Reductores_de_velocidad}}
a sus respectivos motores de DC y una tercer rueda no conectada a ningún
motor que sirve como tercer punto de apoyo para el cuerpo del robot.
La alimentación eléctrica del robot es provista por 6 pilas AA.

En cuanto a los sensores, el robot está equipado con:
\begin{itemize}
    \item Dos emisores infrarrojos a los lados de su parte frontal y un
        sensor infrarrojo entre ellos que permite sensar (de acuerdo a si se
        refleja el haz de luz infrarroja de alguno de los laterales) si
        hay algún obstáculo a la derecha o a la izquierda del robot.
    \item Tres fotorresistores ubicados dentro de 3 cavidades al frente del
        robot que permiten sensar la presencia de fuentes de luz e
        identificar (si la luz no es muy difusa) si las mismas se encuentran
        directamente enfrente, a la izquierda o a la derecha del robot.
    \item Dos sensores de línea que consisten cada uno de un emisor
        y un sensor infrarrojo, los mismos detectan cambios de contraste
        en el piso de acuerdo a la cantidad de luz IR reflejada y generalmente
        se utilizan para que el robot siga un camino demarcado por una línea
        de un color sobre una superficie de un color contrastante.
\end{itemize}

Si bien las anteriores son las características generales del robot, usándolo
de esta manera hay que programarlo a través de un cable serial usando el
lenguaje PBASIC basado en BASIC, para nuestro proyecto utilizamos una versión
que agrega un dispositivo extra, el FLUKE-6, que se conecta al puerto
serial del robot y provee la capacidad de comandarlo de forma inalámbrica
usando Bluetooth, además de agregar otra serie de sensores. Conectar el
FLUKE-6 invierte el sentido de giro de las ruedas, por lo que el frente
del robot pasa a ser el lugar donde se conecta el FLUKE-6. De aquí
en adelante cuando se mencione la parte delantera del Scribbler, será la
parte donde se encuentra conectado el FLUKE-6 y la parte trasera será la
opuesta.

El FLUKE-6 es comandado por con un microcontrolador \textit{LPC2106F} basado
en la arquitectura
\textit{ARM7}~\footnote{\url{http://pdf1.alldatasheet.com/datasheet-pdf/view/83950/PHILIPS/LPC2106FHN48.html}}
, posee un módulo de comunicaciones
Bluetooth que utiliza como medio de comunicación con la computadora
controlante
provee una camara de baja resolución con la que se pueden tomar fotografías
que luego serán transmitidas por bluetooth y además agrega
un sensor infrarrojo que permite detectar la presencia de obstáculos
a la izquierda, al centro o a la derecha (está compuesto de 3 emisores
y un receptor). Con esta adición el robot queda equipado ahora con sensores
en la parte frontal y en la parte trasera, pero más importante aún
el módulo Bluetooth permite controlarlo de forma inalámbrica siempre
que se grabe un firmware especial en la placa FLUKE-6, esto es lo que permite
que estos robots puedan ser programados con Python unsando la biblioteca
\textit{Myro}.

\subsection{Multiplo N6}
El robot Multiplo N6 fabricado por la empresa RobotGroup cuenta con un
microcontrolador Atmel \textit{AVR ATMega32U4} con el bootloader de Arduino
precargado, para su locomoción cuenta con dos ruedas conectadas a través
de reductores de velocidad a sus correspondientes motores DC y una tercer
rueda no conectada a ningún motor que sirve como tercer punto de apoyo,
la alimentación eléctrica de estos robots está dada por tres pilas AA
en serie (o bien dos packs de tres pilas cada uno en paralelo).

En cuanto a los sensores el N6 está equipado con:
\begin{itemize}
    \item Un sensor ultrasónico para detectar obstáculos al frente del
        robot.
    \item Un sensor infrarrojo que puede ser utilizado en conjunto con
        un control remoto universal para enviar comandos al robot
        (siempre que se programe este comportamiento previamente).
    \item Dos sensores detectores de línea, compuestos de un emisor y
        un receptor infrarrojo cada uno.
    \item Opcionalmente estos sensores pueden desatornillarse y ensamblarse
        para funcionar como encoders de las ruedas, de esta manera pudiendo
        calcular la velocidad de giro de las ruedas (pero este uso
        no es recomendable si se controla el robot de forma remota
        ya que la latencia de las comunicaciones puede hacer que se pierdan
        datos haciendo que el cálculo de la velocidad se impreciso).
\end{itemize}

En esta configuración estos robots son programables usando el entorno de
Arduino, pero dado que el proyecto tenía por objetivo la enseñanza de 
programación en el lenguaje Python se encargó al fabricante una modificación
para hacer que el robot se pudiera controlar de forma inalámbrica, esta
modificación consistió en la adición de un módulo de comunicación inalámbrica
XBee que permite enviar y recibir datos del robot a traves del protocolo
ZigBee. Adicionalmente los fabricantes proveyeron a los integrantes del
proyecto \proyecto{} de una implementación
inicial de un firmware basado en la implementación para Arduino del protocolo
de control \texttt{Firmata} y
de un módulo Python para controlar a los robots usando este protocolo, el
cuál fue adaptado por los miembros del proyecto \proyecto{}
para soportar nuevas funcionalidades y proveer una
API similar a la de la biblioteca \texttt{Myro}. Además para interactuar

\section{Características comunes}
Aunque se han utilizado a la fecha estos dos modelos distintos de robots,
en esencia, las características principales de ambos modelos son las mismas
y coinciden con las de otros robots usados en la Argentina para enseñar a
programar, a saber:
\begin{itemize}
    \item El medio de locomoción es con 2 motores continuos que mueven cada
        uno una de las ruedas laterales.
    \item Cuentan con algún sensor o sensores que permiten detectar obstáculos.
    \item Cuentan con algún sensor o sensores que permiten detectar líneas.
    \item Operan sin el uso de cables
\end{itemize}

Cabe destacar sobre este último ítem que algunos de los robots no requieren
cables para operar ya que son programados con anterioridad a través de un
cable (usualmente USB o Serial) normalmente en algún lenguaje como C, Assembler
o Basic. Pero los robots usados en el proyecto antes mencionado no requieren cables ya que son controlados a través de señales
inalámbricas lo que permite controlarlos en tiempo real y utilizando
un intérprete Python estándar (cPython) instalado en el dispositivo
controlante.

Dado el costo y fragilidad de los robots habitualmente los alumnos interactúan
con los mismos solamente en el aula, ya sea en su escuela si la misma pudo adquirir los mismos o en las instalaciones de la  Facultad de Informática si el alumno
realiza alguna pasantía o práctica en la misma. Esto tiene varias connotaciones:
\begin{itemize}
    \item El alumno al estar en una situación formal en la escuela
        compartiendo el recurso limitado que es el robot con otros
        alumnos posiblemente no tenga el tiempo o el ambiente más apropiado
        para experimentar de forma lúdica con el robot.
    \item La tarea para casa solamente es realizable a través de un simulador
        que puede ser lo suficientemente completo y fiel como para aprender
        a programar, pero resulta menos estimulante y realista que manipular
        un robot real.
    \item Alumnos de escuelas que no tienen los recursos necesarios para
        adquirir el equipamiento o de escuelas alejadas de La Plata que
        no tienen la posibilidad de acercarse a nuestra
        Facultad no pueden interactuar con robots reales
        (a lo sumo podrán usar un simulador).
\end{itemize}

Por otro lado los dongles XBee que permiten conectarse con los robots
Multiplo N6
son relativamente costosos, el esquema normal de conexionado entre dispositivos
controladores y robots descripto en el capítulo~\ref{cha:arquitectura} requiere
2 dongles XBee por robot, uno conectado directamente al robot y el otro
conectado por USB al dispositivo controlante. En consecuencia:
\begin{itemize}
    \item El dispositivo controlante debe tener un puerto USB y los drivers
        necesarios para detectar la interfaz serial con el XBee, esto deja
        fuera de juego celulares y tablets.
    \item El costo de operar cada robot en este esquema es sensiblemente
        superior al costo que tendría si varios alumnos pudieran
        controlar varios robots usando un solo dispositivo XBee compartido
        entre varios dispositivos controlantes.
\end{itemize}

Tomando estos dos grupos de problemáticas se propone implementar una solución
que permita
superarlos de forma simultánea, esta solución permite controlar los
robots a través de una red, como puede ser Internet, permitiendo a los alumnos
conectarse a los robots desde sus hogares y a las instituciones a compartir
el uso de sus robots. Por otro lado también es posible configurar el servidor
para su uso en el aula deshabilitando funcionalidades innecesarias en un ámbito
local como ser la necesidad de autenticar a los usuarios para utilizar los
robots, este modo de operación fue pensado para que múltiples alumnos puedan
acceder a múltiples robots contando con un solo adaptador USB a XBee, esto
reduciría sensiblemente el costo de cada robot por alumno ya que de otra
manera por cada robot deberían usarse 2 dispositivos XBee (uno en el robot
y otro en la computadora del alumno) reduciéndose con este modo de operación
a un XBee por robot más un único adaptador USB a XBee conectado al servidor.

Como consecuencia de estos requerimientos quedaba claro que el servidor
debía tener una interfaz web y proveer acceso concurrente con relativa
baja latencia para permitir a múltiples alumnos acceder a múltiples robots
al mismo tiempo. Tener un servidor web basado en protocolos estándar hizo
que el requerimiento de que el cliente estuviera escrito en Python fuera
artificial dado que sería posible implementar clientes en cualquier lenguaje
que soporte estos protocolos. Esto dio lugar a la posibilidad de
implementar otros clientes que permitieran usar los robots en cursos
de programación de distintos lenguajes sin reimplementar el protocolo
de bajo nivel lo que hace en opinión del autor más sencilla la creación
de nuevos clientes en distintos lenguajes.
En especial la elección de protocolos y tecnologías usadas
y la falta de necesidad de acceder directamente al hardware a través de USB
habilita la implementación de un cliente Javascript que se ejecute en el
navegador Web de los usuarios.

El nivel de abstracción que puede proveer esta API hace que también sea
natural pensar en la posibilidad de manejar distintos tipos de robots
que tengan algunas características mínimas en común con los robots ya
descriptos.

El servidor RemoteBot original (figura~\ref{fig:arquitectura_remotebot})
tenía algunas de estas características, pero
estaba pobremente implementado ya que no era más que una herramienta auxiliar
para un cliente muy específico y era meramente un intermediario entre el
cliente original implementado en Java y el módulo DuinoBot. Este servidor
estaba severamente limitado
ya que no era configurable, no contaba con ninguna forma de visualizar a los
robots de forma remota, no permitía autenticación, no disponía un sistema
de reserva de robots por lo que un cliente podía interferir en la operación
de un robot de otro cliente y las operaciones bloqueantes de un cliente
impedían el uso de los robots al resto de los clientes hasta que esa operación
terminase.

% FIXME: CREO QUE ESTARÍA BUENO QUE ACA PONGAS UNA FIGURA CON LA ARQUITETURA DE REMOTEBOOT
% Lo puse en otra sección donde se habla más en detalle. Fernando. Armé otra
% que muestra como se conectan, tengo límite poco claro entre lo que le digo
% arquitectura y los diagramas de bloque...

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{figures/arquitectura_remotebot}
    \caption{Esquema de conexión de RemoteBot}\label{fig:arquitectura_remotebot}
\end{figure}


